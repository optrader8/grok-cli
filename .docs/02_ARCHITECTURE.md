# ì•„í‚¤í…ì²˜

## ğŸ“ í•µì‹¬ ì•„í‚¤í…ì²˜ íŒ¨í„´

Grok CLIëŠ” **ì—ì´ì „íŠ¸ ê¸°ë°˜ ë„êµ¬ ì‹¤í–‰ ë£¨í”„** íŒ¨í„´ì„ ë”°ë¦…ë‹ˆë‹¤.

### Agent-Based Tool Execution Loop

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì‚¬ìš©ì ì…ë ¥                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Grok Agent (AI)                        â”‚
â”‚  - ì‚¬ìš©ì ì˜ë„ ë¶„ì„                                  â”‚
â”‚  - í•„ìš”í•œ ë„êµ¬ ê²°ì •                                  â”‚
â”‚  - ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ + ì»¤ìŠ¤í…€ ì§€ì¹¨                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ë„êµ¬ ì‹¤í–‰ (Tools)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ íŒŒì¼í¸ì§‘ â”‚  ê²€ìƒ‰    â”‚  Bash    â”‚   MCP    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ê²°ê³¼ ì²˜ë¦¬ ë° ë‹¤ìŒ ì•¡ì…˜ ê²°ì •                 â”‚
â”‚  - ë„êµ¬ ì‹¤í–‰ ê²°ê³¼ ë¶„ì„                               â”‚
â”‚  - ì¶”ê°€ ë„êµ¬ í•„ìš” ì—¬ë¶€ íŒë‹¨                          â”‚
â”‚  - ìµœì¢… ì‘ë‹µ ìƒì„±                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚
   ì¢…ë£Œ ì¡°ê±´?              ì¶”ê°€ ì‘ì—…?
        â”‚                     â”‚
        â–¼                     â–¼
   ìµœì¢… ì‘ë‹µ            ë£¨í”„ ë°˜ë³µ
                      (ìµœëŒ€ 400íšŒ)
```

### ì‹¤í–‰ íë¦„ ì˜ˆì‹œ

```typescript
// 1. ì‚¬ìš©ì ì…ë ¥
User: "Fix the TypeScript errors in src/api.ts"

// 2. AI ë¶„ì„ ë° ë„êµ¬ ì„ íƒ
Agent decides: [
  { tool: "view_file", args: { path: "src/api.ts" } },
]

// 3. ë„êµ¬ ì‹¤í–‰
Tool executes â†’ Returns file content with errors

// 4. AI ë¶„ì„ ë° ë‹¤ìŒ ë„êµ¬
Agent decides: [
  { tool: "str_replace_editor", args: {
    path: "src/api.ts",
    old_str: "...",
    new_str: "..."
  }}
]

// 5. ì‚¬ìš©ì í™•ì¸ â†’ ìŠ¹ì¸ â†’ ì‹¤í–‰

// 6. ìµœì¢… ì‘ë‹µ
Agent: "I've fixed 3 TypeScript errors in src/api.ts..."
```

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ë ˆì´ì–´ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              UI Layer (React Ink)                   â”‚
â”‚  - chat-interface.tsx (ë©”ì¸ UI)                     â”‚
â”‚  - chat-history.tsx (ë©”ì‹œì§€ íˆìŠ¤í† ë¦¬)                â”‚
â”‚  - confirmation-dialog.tsx (í™•ì¸ ëŒ€í™”ìƒì)            â”‚
â”‚  - diff-renderer.tsx (ë³€ê²½ì‚¬í•­ ì‹œê°í™”)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Application Layer                         â”‚
â”‚  - grok-agent.ts (í•µì‹¬ ì—ì´ì „íŠ¸ ë¡œì§)                â”‚
â”‚  - use-input-handler.ts (ì…ë ¥ ì²˜ë¦¬)                 â”‚
â”‚  - confirmation-service.ts (í™•ì¸ ì„œë¹„ìŠ¤)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Tool Layer                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Built-in Tools                            â”‚    â”‚
â”‚  â”‚  - text-editor.ts (íŒŒì¼ í¸ì§‘)              â”‚    â”‚
â”‚  â”‚  - morph-editor.ts (ê³ ì† í¸ì§‘)             â”‚    â”‚
â”‚  â”‚  - bash.ts (ëª…ë ¹ ì‹¤í–‰)                     â”‚    â”‚
â”‚  â”‚  - search.ts (í†µí•© ê²€ìƒ‰)                   â”‚    â”‚
â”‚  â”‚  - todo-tool.ts (í• ì¼ ê´€ë¦¬)                â”‚    â”‚
â”‚  â”‚  - confirmation-tool.ts (í™•ì¸ ì²˜ë¦¬)        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  MCP Tools (Dynamic)                       â”‚    â”‚
â”‚  â”‚  - mcp__linear__* (Linear í†µí•©)            â”‚    â”‚
â”‚  â”‚  - mcp__github__* (GitHub í†µí•©)            â”‚    â”‚
â”‚  â”‚  - mcp__custom__* (ì»¤ìŠ¤í…€ ì„œë²„)            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Integration Layer                        â”‚
â”‚  - client.ts (Grok API)                            â”‚
â”‚  - mcp/client.ts (MCP í´ë¼ì´ì–¸íŠ¸)                   â”‚
â”‚  - ripgrep-node (ê²€ìƒ‰)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Infrastructure Layer                      â”‚
â”‚  - settings-manager.ts (ì„¤ì • ê´€ë¦¬)                  â”‚
â”‚  - token-counter.ts (í† í° ì¹´ìš´íŒ…)                   â”‚
â”‚  - File System (fs-extra)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¨ ì ìš©ëœ ë””ìì¸ íŒ¨í„´

### 1. Singleton Pattern

**ì‚¬ìš© ìœ„ì¹˜**: `SettingsManager`, `ConfirmationService`, `MCPManager`

```typescript
// src/utils/settings-manager.ts
export class SettingsManager {
  private static instance: SettingsManager;

  static getInstance(): SettingsManager {
    if (!SettingsManager.instance) {
      SettingsManager.instance = new SettingsManager();
    }
    return SettingsManager.instance;
  }

  // ì „ì—­ ì„¤ì • ê´€ë¦¬
  getUserSettings(): UserSettings { }
  getProjectSettings(): ProjectSettings { }
  setCurrentModel(model: string): void { }
}
```

**ì´ìœ **: ì „ì—­ì ìœ¼ë¡œ í•˜ë‚˜ì˜ ì„¤ì • ì¸ìŠ¤í„´ìŠ¤ë§Œ í•„ìš”

### 2. Strategy Pattern

**ì‚¬ìš© ìœ„ì¹˜**: MCP Transport êµ¬í˜„

```typescript
// src/mcp/transports.ts
interface Transport {
  connect(): Promise<void>;
  disconnect(): Promise<void>;
  send(message: any): Promise<any>;
}

class StdioTransport implements Transport { }
class SSETransport implements Transport { }
class HTTPTransport implements Transport { }

// ëŸ°íƒ€ì„ì— ì „ì†¡ ë°©ì‹ ì„ íƒ
function createTransport(config: TransportConfig): Transport {
  switch (config.type) {
    case 'stdio': return new StdioTransport(config);
    case 'sse': return new SSETransport(config);
    case 'http': return new HTTPTransport(config);
  }
}
```

**ì´ìœ **: ë‹¤ì–‘í•œ MCP ì „ì†¡ ë°©ì‹ì„ í†µì¼ëœ ì¸í„°í˜ì´ìŠ¤ë¡œ ì²˜ë¦¬

### 3. Observer Pattern

**ì‚¬ìš© ìœ„ì¹˜**: `MCPManager`, `ConfirmationService`

```typescript
// src/utils/confirmation-service.ts
export class ConfirmationService extends EventEmitter {
  requestConfirmation(data: ConfirmationData): Promise<boolean> {
    return new Promise((resolve) => {
      this.emit('confirmation-needed', data, resolve);
    });
  }
}

// UIì—ì„œ êµ¬ë…
confirmationService.on('confirmation-needed', (data, callback) => {
  // UIì— í™•ì¸ ëŒ€í™”ìƒì í‘œì‹œ
  showDialog(data).then(callback);
});
```

**ì´ìœ **: UIì™€ ë¡œì§ ê³„ì¸µ ê°„ì˜ ëŠìŠ¨í•œ ê²°í•©

### 4. Factory Pattern

**ì‚¬ìš© ìœ„ì¹˜**: Tool ìƒì„±, Transport ì´ˆê¸°í™”

```typescript
// src/grok/tools.ts
export function createTools(mcpTools: MCPTool[] = []): Tool[] {
  return [
    createViewFileTool(),
    createEditFileTool(),
    createSearchTool(),
    createBashTool(),
    ...mcpTools.map(createMCPTool)
  ];
}
```

**ì´ìœ **: ë„êµ¬ ê°ì²´ ìƒì„± ë¡œì§ ìº¡ìŠí™”

### 5. Command Pattern

**ì‚¬ìš© ìœ„ì¹˜**: CLI ëª…ë ¹ì–´ êµ¬ì¡°

```typescript
// src/index.ts
const program = new Command();

program
  .command('mcp')
  .description('Manage MCP servers')
  .command('add')
  .action(async (name, options) => {
    // ëª…ë ¹ ì‹¤í–‰ ë¡œì§
  });
```

**ì´ìœ **: ëª…ë ¹ì–´ë¥¼ ê°ì²´ë¡œ ìº¡ìŠí™”í•˜ì—¬ í™•ì¥ì„± í–¥ìƒ

### 6. Streaming Pattern

**ì‚¬ìš© ìœ„ì¹˜**: AI ì‘ë‹µ ì²˜ë¦¬

```typescript
// src/agent/grok-agent.ts
async function* streamResponse(prompt: string) {
  const stream = await client.chat.completions.create({
    stream: true,
    messages: [{ role: 'user', content: prompt }]
  });

  for await (const chunk of stream) {
    yield chunk.choices[0]?.delta?.content || '';
  }
}
```

**ì´ìœ **: ì‹¤ì‹œê°„ ì‘ë‹µìœ¼ë¡œ ì‚¬ìš©ì ê²½í—˜ ê°œì„ 

## ğŸ”„ ë°ì´í„° íë¦„

### 1. ë©”ì‹œì§€ íë¦„

```
ì‚¬ìš©ì ì…ë ¥
    â”‚
    â–¼
use-input-handler.ts
    â”‚ (ì…ë ¥ ê²€ì¦ ë° ì „ì²˜ë¦¬)
    â–¼
grok-agent.ts
    â”‚ (AIì—ê²Œ ë©”ì‹œì§€ ì „ì†¡)
    â–¼
Grok API (X.AI)
    â”‚ (ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ)
    â–¼
grok-agent.ts
    â”‚ (ì‘ë‹µ íŒŒì‹± ë° ë„êµ¬ í˜¸ì¶œ ì¶”ì¶œ)
    â–¼
Tool Execution
    â”‚ (ë„êµ¬ ì‹¤í–‰ ë° ê²°ê³¼ ë°˜í™˜)
    â–¼
chat-interface.tsx
    â”‚ (UI ì—…ë°ì´íŠ¸)
    â–¼
ì‚¬ìš©ìì—ê²Œ í‘œì‹œ
```

### 2. ì„¤ì • ë¡œë“œ íë¦„

```
í™˜ê²½ ë³€ìˆ˜ (.env)
    â”‚
    â–¼
CLI ì¸ì (--api-key, --model ë“±)
    â”‚
    â–¼
ì‚¬ìš©ì ì„¤ì • (~/.grok/user-settings.json)
    â”‚
    â–¼
í”„ë¡œì íŠ¸ ì„¤ì • (.grok/settings.json)
    â”‚
    â–¼
SettingsManager
    â”‚ (ìš°ì„ ìˆœìœ„ ë³‘í•©)
    â–¼
ìµœì¢… ì„¤ì •
```

**ìš°ì„ ìˆœìœ„**:
1. CLI ì¸ì (ìµœê³  ìš°ì„ ìˆœìœ„)
2. í™˜ê²½ ë³€ìˆ˜
3. í”„ë¡œì íŠ¸ ì„¤ì •
4. ì‚¬ìš©ì ì„¤ì •
5. ê¸°ë³¸ê°’ (ìµœì € ìš°ì„ ìˆœìœ„)

### 3. ë„êµ¬ ì‹¤í–‰ íë¦„

```
AI ë„êµ¬ í˜¸ì¶œ ìš”ì²­
    â”‚
    â–¼
confirmation-service.ts
    â”‚ (í™•ì¸ í•„ìš” ì—¬ë¶€ í™•ì¸)
    â”‚
    â”œâ”€â”€> í™•ì¸ í•„ìš”
    â”‚    â”‚
    â”‚    â–¼
    â”‚    confirmation-dialog.tsx
    â”‚    â”‚ (ì‚¬ìš©ì ìŠ¹ì¸/ê±°ë¶€)
    â”‚    â–¼
    â”‚    ìŠ¹ì¸ë¨?
    â”‚    â”‚
    â””â”€â”€â”€â”€â”˜
    â”‚
    â–¼
ë„êµ¬ ì‹¤í–‰ (text-editor, bash, ë“±)
    â”‚
    â–¼
ê²°ê³¼ ìƒì„±
    â”‚
    â–¼
AIì—ê²Œ ë°˜í™˜
```

### 4. MCP ë„êµ¬ ë“±ë¡ íë¦„

```
í”„ë¡œì íŠ¸ ì„¤ì • ë¡œë“œ
    â”‚
    â–¼
mcp/config.ts
    â”‚ (MCP ì„œë²„ ì„¤ì • ì½ê¸°)
    â–¼
mcp/client.ts
    â”‚ (ê° ì„œë²„ì— ì—°ê²°)
    â”‚
    â”œâ”€â”€> stdio ì„œë²„
    â”‚    â”‚ (í•˜ìœ„ í”„ë¡œì„¸ìŠ¤ ì‹œì‘)
    â”‚    â–¼
    â”‚    ë„êµ¬ ëª©ë¡ ìš”ì²­
    â”‚
    â”œâ”€â”€> SSE ì„œë²„
    â”‚    â”‚ (EventSource ì—°ê²°)
    â”‚    â–¼
    â”‚    ë„êµ¬ ëª©ë¡ ìš”ì²­
    â”‚
    â””â”€â”€> HTTP ì„œë²„
         â”‚ (HTTP í´ë¼ì´ì–¸íŠ¸ ìƒì„±)
         â–¼
         ë„êµ¬ ëª©ë¡ ìš”ì²­
    â”‚
    â–¼
ëª¨ë“  ë„êµ¬ ë³‘í•©
    â”‚
    â–¼
grok-agent.ts
    â”‚ (ë„êµ¬ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ë“±ë¡)
    â–¼
AIê°€ ì‚¬ìš© ê°€ëŠ¥
```

## ğŸš€ ìµœì í™” ì „ëµ

### 1. ìŠ¤íŠ¸ë¦¬ë° ì•„í‚¤í…ì²˜

```typescript
// ì¦‰ê°ì ì¸ ì‘ë‹µ ì‹œì‘
async function handleMessage(message: string) {
  const stream = agent.processMessageStream(message);

  for await (const chunk of stream) {
    // ì²­í¬ ì¦‰ì‹œ í‘œì‹œ (ë²„í¼ë§ ì—†ìŒ)
    updateUI(chunk);
  }
}
```

**ì¥ì **:
- ì²« í† í°ê¹Œì§€ì˜ ì‹œê°„(TTFT) ë‹¨ì¶•
- ì‚¬ìš©ì ê²½í—˜ í–¥ìƒ
- ë©”ëª¨ë¦¬ íš¨ìœ¨ì 

### 2. ë³‘ë ¬ ë„êµ¬ ì‹¤í–‰

```typescript
// ë…ë¦½ì ì¸ ë„êµ¬ëŠ” ë³‘ë ¬ ì‹¤í–‰
const results = await Promise.all([
  viewFile('src/api.ts'),
  viewFile('src/types.ts'),
  searchCode('AuthService')
]);
```

**ì¥ì **:
- ì‹¤í–‰ ì‹œê°„ ë‹¨ì¶•
- ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­í­ ìµœì  í™œìš©

### 3. ë°±ê·¸ë¼ìš´ë“œ ì´ˆê¸°í™”

```typescript
// MCP ì„œë²„ëŠ” ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì´ˆê¸°í™”
async function initialize() {
  // UIëŠ” ì¦‰ì‹œ í‘œì‹œ
  showUI();

  // MCPëŠ” ë¹„ë™ê¸°ë¡œ ì—°ê²°
  mcpManager.initializeAll().catch(console.error);
}
```

**ì¥ì **:
- ì•± ì‹œì‘ ì‹œê°„ ë‹¨ì¶•
- ë¸”ë¡œí‚¹ ë°©ì§€

### 4. í† í° ì¹´ìš´íŒ… ìºì‹±

```typescript
// ì¸ì½”ë”© ê°ì²´ ì¬ì‚¬ìš©
const encodingCache = new Map<string, Tiktoken>();

function getEncoding(model: string): Tiktoken {
  if (!encodingCache.has(model)) {
    encodingCache.set(model, encoding_for_model(model));
  }
  return encodingCache.get(model)!;
}
```

**ì¥ì **:
- ë°˜ë³µì ì¸ ì´ˆê¸°í™” ë¹„ìš© ì œê±°
- ë©”ëª¨ë¦¬ íš¨ìœ¨

### 5. ì¡°ê¸° ë„êµ¬ í˜¸ì¶œ ìƒì„±

```typescript
// í•¨ìˆ˜ëª… í™•ì¸ ì¦‰ì‹œ ë„êµ¬ í˜¸ì¶œ ì‹œì‘
for await (const chunk of stream) {
  if (chunk.tool_call?.function?.name) {
    // ì „ì²´ ì¸ìë¥¼ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  ì¤€ë¹„
    prepareToolExecution(chunk.tool_call.function.name);
  }
}
```

**ì¥ì **:
- ë„êµ¬ ì‹¤í–‰ ì§€ì—° ìµœì†Œí™”
- ì „ì²´ ì‘ë‹µ ì‹œê°„ ë‹¨ì¶•

## ğŸ” ë³´ì•ˆ ì•„í‚¤í…ì²˜

### 1. ê³„ì¸µì  í™•ì¸ ì‹œìŠ¤í…œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ìë™ í¸ì§‘ ëª¨ë“œ OFF (ê¸°ë³¸ê°’)     â”‚
â”‚  âœ ëª¨ë“  ì‘ì—… í™•ì¸ í•„ìš”               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ì„¸ì…˜ë³„ "ë‹¤ì‹œ ë¬»ì§€ ì•Šê¸°" ì˜µì…˜       â”‚
â”‚  âœ íŠ¹ì • ì‘ì—… ìœ í˜•ë§Œ ìë™ ìŠ¹ì¸         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ìë™ í¸ì§‘ ëª¨ë“œ ON               â”‚
â”‚  âœ íŒŒì¼ ì‘ì—… ìë™ ìŠ¹ì¸               â”‚
â”‚  âœ Bash ëª…ë ¹ì€ ì—¬ì „íˆ í™•ì¸ í•„ìš”       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         í—¤ë“œë¦¬ìŠ¤ ëª¨ë“œ                â”‚
â”‚  âœ ëª¨ë“  ì‘ì—… ìë™ ìŠ¹ì¸               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. API í‚¤ ë³´í˜¸

```typescript
// ~/.grok/user-settings.json íŒŒì¼ ê¶Œí•œ: 0o600
fs.chmodSync(settingsPath, 0o600);

// í™˜ê²½ ë³€ìˆ˜ ìš°ì„  ì‚¬ìš©
const apiKey = process.env.GROK_API_KEY || settings.apiKey;
```

### 3. ëª…ë ¹ ê²€ì¦

```typescript
// cd ëª…ë ¹ ê°€ë¡œì±„ê¸°
if (command.startsWith('cd ')) {
  const dir = command.slice(3).trim();
  process.chdir(dir);
  return { output: `Changed directory to ${dir}` };
}

// íƒ€ì„ì•„ì›ƒ ì ìš©
exec(command, { timeout: 30000 }, callback);
```

## ğŸ“Š í™•ì¥ì„± ì„¤ê³„

### 1. ë„êµ¬ ì¶”ê°€í•˜ê¸°

```typescript
// ìƒˆ ë„êµ¬ ì •ì˜
export const myCustomTool: Tool = {
  name: 'my_custom_tool',
  description: 'Does something custom',
  parameters: {
    type: 'object',
    properties: {
      input: { type: 'string' }
    }
  }
};

// ë„êµ¬ êµ¬í˜„
export async function executeMyCustomTool(args: any): Promise<ToolResult> {
  // êµ¬í˜„
  return { output: 'Success' };
}

// ë„êµ¬ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì— ë“±ë¡
tools.push(myCustomTool);
```

### 2. MCP ì„œë²„ ì¶”ê°€í•˜ê¸°

```bash
# CLIë¡œ ê°„ë‹¨í•˜ê²Œ ì¶”ê°€
grok mcp add myserver -t stdio -c "bun" -a "server.js"

# ë˜ëŠ” JSON ì„¤ì • ìˆ˜ì •
# .grok/settings.json
{
  "mcpServers": {
    "myserver": {
      "name": "myserver",
      "transport": {
        "type": "stdio",
        "command": "bun",
        "args": ["server.js"]
      }
    }
  }
}
```

### 3. ìƒˆ AI ëª¨ë¸ ì¶”ê°€í•˜ê¸°

```typescript
// OpenAI í˜¸í™˜ APIë¼ë©´ ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥
const client = new OpenAI({
  apiKey: 'your-key',
  baseURL: 'https://api.your-provider.com/v1'
});

// ì„¤ì • íŒŒì¼ì— ì¶”ê°€
{
  "models": [
    "grok-code-fast-1",
    "gpt-4-turbo",
    "claude-3-opus", // via OpenRouter
    "your-custom-model"
  ]
}
```

## ğŸ¯ í•µì‹¬ ì„¤ê³„ ì›ì¹™

### 1. ì‚¬ìš©ì ì•ˆì „ ìš°ì„ 

- íŒŒê´´ì  ì‘ì—… ì „ ë°˜ë“œì‹œ í™•ì¸
- ëª…í™•í•œ ë³€ê²½ì‚¬í•­ ì‹œê°í™”
- ì‹¤í–‰ ì·¨ì†Œ ê¸°ëŠ¥ ì œê³µ

### 2. í™•ì¥ ê°€ëŠ¥ì„±

- MCPë¥¼ í†µí•œ ë¬´í•œ í™•ì¥
- ë„êµ¬ ì¶”ê°€ê°€ ê°„ë‹¨
- ëª¨ë“ˆì‹ ì•„í‚¤í…ì²˜

### 3. ì„±ëŠ¥ ìµœì í™”

- ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œ ë¹ ë¥¸ ì‘ë‹µ
- ë³‘ë ¬ ì²˜ë¦¬ ì ê·¹ í™œìš©
- ìºì‹± ì „ëµ

### 4. ê°œë°œì ê²½í—˜

- íƒ€ì… ì•ˆì „ì„± (TypeScript)
- ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€
- í’ë¶€í•œ ë””ë²„ê¹… ì •ë³´

### 5. ìœ ì§€ë³´ìˆ˜ì„±

- ë‹¨ì¼ ì±…ì„ ì›ì¹™
- ëŠìŠ¨í•œ ê²°í•©
- ë†’ì€ ì‘ì§‘ë„
